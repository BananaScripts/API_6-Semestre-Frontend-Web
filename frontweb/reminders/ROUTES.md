# Akasys Backend — API Routes

Base URL: http://127.0.0.1:8000 (when server is running)

This file summarizes all HTTP routes in the project so you can copy them into your web project.

---

## 1) POST /upload/{tipo}
- Description: Upload CSV file and trigger import pipeline.
- Method: POST
- Path params:
  - `tipo` (string, path) — allowed values: `vendas`, `estoque`
- Request:
  - multipart/form-data with field `file` (the CSV file)
- Response (201):
  - JSON: `{ "status": "sucesso", "arquivo": "<filename>", "tipo": "<tipo>" }`
- Errors:
  - 400: invalid `tipo`
  - 500: save/import errors
- Notes: enum `Upload` is defined in `src/BaseModel/Upload.py`

## 2) POST /relatorios/enviar
- Description: Generate reports and send by email.
- Method: POST
- Request body (JSON):
  - `email` (object) — see Email model below { "email": "recipient@example.com" }
  - `assunto` (string) — subject
  - `corpo` (string) — message body
- Response (200):
  - JSON indicating success and a message
- Notes: endpoint uses `src/gerar_relatorios.py` and `src/enviar_email.py` to build and send attachments.

## 3) POST /usuario
- Description: Create a new user.
- Method: POST
- Request body (JSON):
  - `nome` (string)
  - `email` (string, email format)
  - `senha` (string)
- Response (201):
  - `Usuario` object: `{ "nome":..., "email":..., "senha":... }`
- Errors:
  - 409 if email already registered

## 4) GET /usuario/{usuario_id}
- Description: Get user by id
- Method: GET
- Path params:
  - `usuario_id` (int)
- Response (200): `Usuario` object
- Errors: 404 if not found

## 5) PUT /usuario/{usuario_id}
- Description: Update user (partial)
- Method: PUT
- Path params:
  - `usuario_id` (int)
- Request body (JSON): `UpdateUsuario` (all fields optional):
  - `nome` (string)
  - `email` (string, email format)
  - `senha` (string)
- Response (200): `Usuario` object
- Errors: 404 if not found

## 6) DELETE /usuario/{usuario_id}
- Description: Delete a user
- Method: DELETE
- Path params:
  - `usuario_id` (int)
- Response: 204 No Content

## 7) GET /vendas
- Description: List vendas (sales) from DB
- Method: GET
- Query params:
  - `skip` (int, default 0, >=0)
  - `limit` (int, default 10, min 1, max 100)
- Response (200): array of `Venda` objects (see models below)

## 8) GET /estoque
- Description: List estoque (stock) from DB
- Method: GET
- Query params:
  - `skip` (int, default 0, >=0)
  - `limit` (int, default 10, min 1, max 100)
- Response (200): array of `Estoque` objects (see models below)

## 9) GET /
- Description: Health check
- Method: GET
- Response: `{ "status": "ok", "msg": "API funfando" }`

---

# Models (shapes)

## Usuario / CreateUsuario
- nome: string
- email: string (email format)
- senha: string

## UpdateUsuario
- nome?: string
- email?: string
- senha?: string

## Email
- email: string (email format)

## Venda (selected fields)
- id_venda: int
- data: date
- cod_cliente: str
- cod_produto: str
- lote?: str
- origem?: str
- produto?: str
- sku?: str
- zs_peso_liquido?: float
- giro_sku_cliente?: float

## Estoque (selected fields)
- id_estoque: int
- data: date
- cod_cliente: str
- cod_produto: str
- es_centro?: str
- tipo_material?: str
- origem?: str
- dias_em_estoque?: int
- produto?: str
- es_totalestoque?: float
- sku?: str

---

# Notes for web project
- The upload endpoint expects multipart/form-data. Use FormData in JS to upload files.
- The `/relatorios/enviar` endpoint mixes a Pydantic model and plain params — using the interactive docs (`/docs`) is easiest to see the exact request form. If creating manually, send JSON like:

```json
{
  "email": { "email": "recipient@example.com" },
  "assunto": "Relatórios",
  "corpo": "Segue em anexo."
}
```

- All DB-backed endpoints require a running Postgres and proper `.env` configuration.
- Enum values for upload `tipo`: `vendas` | `estoque`.

---

File generated by developer tools; copy to your web project as a reference.
